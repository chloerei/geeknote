<%# locals: (comment:, showpage: false) %>

<div id="<%= dom_id(comment) %>" class="py-4 border-b border-base-300 last:border-b-0">
  <div class="flex gap-4">
    <div class="avatar flex-none">
      <div class="size-10 rounded-full">
        <img src="<%= avatar_url(comment.user) %>" alt="avatar">
      </div>
    </div>
    <div class="flex-grow">
      <div class="text-sm font-medium">
        <%= comment.user.name %>
      </div>
      <div class="text-sm text-base-content/80">
        <a href="<%= account_comment_path(comment.user.account.name, comment) %>">
          <%= format_time comment.created_at %>
        </a>
      </div>
    </div>
  </div>

  <% if comment.parent %>
    <div class="mt-4 group-[.replies]:hidden">
      <a href="<%= account_comment_path(comment.parent.user.account.name, comment.parent) %>" class="card bg-base-200 hover:bg-base-300">
        <div class="card-body">
          <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-reply-icon lucide-reply"><path d="M20 18v-2a4 4 0 0 0-4-4H4"/><path d="m9 17-5-5 5-5"/></svg>
            <span class="font-medium">
              <%= comment.parent.user.name %>
            </span>
            <span class="text-on-surface-variant">
              <%= format_time comment.parent.created_at %>
            </span>
          </div>
          <div class="text-base-content/80 line-clamp-2">
            <%= markdown_summary comment.parent.content %>
          </div>
        </div>
      </a>
    </div>
  <% end %>

  <article class="typography mt-4">
    <%= markdown_render comment.content %>
  </article>

  <div class="flex items-center gap-4 mt-4">
    <%= render "account/comments/likes/button", comment: comment %>

    <% if !showpage %>
      <div class="inline-flex items-center">
        <a href="<%= account_comment_path(comment.user.account.name, comment, comment: true, anchor: "form_comment") %>" class="btn btn-ghost btn-square">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-reply-icon lucide-reply"><path d="M20 18v-2a4 4 0 0 0-4-4H4"/><path d="m9 17-5-5 5-5"/></svg>
        </a>
        <span class="text-on-surface-variant tabular-nums px-1">
          <%= comment.replies_count %>
        </span>
      </div>
    <% end %>

    <div class="dropdown">
      <label tabindex="0" type="button" class="btn btn-ghost btn-square">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ellipsis-icon lucide-ellipsis"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
      </label>
      <div tabindex="0" class="dropdown-content menu bg-base-100 rounded-box w-52 p-2 shadow">
        <li>
          <button type="button" data-controller="copy-link" data-action="copy-link#copy" data-copy-link-url-value="<%= account_comment_path(comment.user.account.name, comment) %>">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link-icon lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
            <%= t "general.copy_link" %>
          </button>
        </li>
        <li class="hidden visible-to-user--<%= comment.user.id %>">
          <a href="<%= edit_account_comment_path(comment.user.account.name, comment) %>">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pencil-icon lucide-pencil"><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/><path d="m15 5 4 4"/></svg>
            <%= t "general.edit" %>
          </a>
        </li>
        <li class="hidden visible-to-user--<%= comment.user.id %>">
          <a href="<%= account_comment_path(comment.user.account.name, comment) %>" data-turbo-method="delete" data-turbo-confirm="Delete this comment?">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-icon lucide-trash"><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
            <%= t "general.delete" %>
          </a>
        </li>
        <li class="hidden visible-to-admin">
          <a href="<%= admin_comment_path(comment) %>">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wrench-icon lucide-wrench"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z"/></svg>
            <%= t "general.manage" %>
          </a>
        </li>
      </div>
    </div>
  </div>
</div>
