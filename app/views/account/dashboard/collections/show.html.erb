<div class="container">
  <div class="layout">
    <%= render 'account/dashboard/navbar' %>

    <div class="main">
      <div class="card card--surface padding-3 margin-bottom-3">
        <div class="breadcrumb">
          <div class="breadcrumb__item">
            <a href="<%= account_dashboard_collections_path(@account) %>">
              <%= t 'common.collections' %>
            </a>
          </div>
          <div class="breadcrumb__item breadcrumb__item--active">
            <%= @collection.name %>
          </div>
        </div>
      </div>

      <div class="card card--surface padding-3 margin-bottom-3">
        <div class="display-flex align-items-center gap-2 margin-bottom-3">
          <div class="flex-grow-1 headline-small">
            <%= @collection.name %>
          </div>
          <a href="<%= edit_account_dashboard_collection_path(@account, @collection) %>" class="button button--icon">
            <span class="material-icons">edit</span>
          </a>
          <div class="dropdown" data-controller="dropdown">
            <button type="button" class="button button--icon" data-action="dropdown#toggle">
              <span class="material-icons">more_vert</span>
            </button>
            <div class="dropdown__container dropdown__container--top-right">
              <a href="<%= account_collection_path(@account, @collection) %>" class="dropdown__item">
                <div class="dropdown__item__icon">
                  <span class="material-icons">preview</span>
                </div>
                <div class="dropdown__item__text">
                  <%= t 'common.view' %>
                </div>
              </a>
              <hr class="divider">
              <%= button_to account_dashboard_collection_path(@account, @collection), method: 'delete', class: 'dropdown__item', data: { confirm: I18n.t('common.delete_collection_confirm') } do %>
                <div class="dropdown__item__icon">
                  <span class="material-icons">delete</span>
                </div>
                <div class="dropdown__item__text">
                  <%= t 'common.delete_collection' %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
        <div class="margin-bottom-3">
          <%= @collection.description.presence || t('common.no_description') %>
        </div>
        <div class="text-muted display-flex align-items-center gap-1">
          <% if @collection.visibility_private? %>
            <span class="material-icons material-icons--inline">lock</span>
            <%= t 'common.private' %>
          <% else %>
            <span class="material-icons material-icons--inline">public</span>
            <%= t 'common.public' %>
          <% end %>
        </div>
      </div>

      <div class="card card--surface">
        <div class="display-flex align-items-center border-bottom">
          <div class="flex-grow-1 title-medium padding-3">
            <%= t 'common.posts' %>
          </div>
          <div class="padding-1">
            <div class="dropdown" data-controller="dropdown">
              <button type="button" class="button button--icon" data-action="dropdown#toggle">
                <span class="material-icons">sort</span>
              </button>
              <div class="dropdown__container dropdown__container--top-right">
                <% Collection.order_types.keys.each do |name| %>
                  <%= button_to account_dashboard_collection_path(@account, @collection), method: 'patch', class: "dropdown__item" do %>
                    <div class="dropdown__item__icon">
                      <% if @collection.order_type == name %>
                        <span class="material-icons">check</span>
                      <% end %>
                    </div>
                    <div class="dropdown__item__text">
                      <%= Collection.human_attribute_name "order_type.#{name}" %>
                    </div>
                    <%= hidden_field_tag 'collection[order_type]', name %>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        </div>

        <% if @collection_items.any? %>
          <div class="list" data-controller="sortable">
            <% @collection_items.each do |collection_item| %>
              <div id="collection-item-<%= collection_item.id %>" class="display-flex align-items-center padding-x-1 padding-y-2 gap-2" data-sortable-target="item" data-controller="draggable collection-item" data-action="sortable:change->collection-item#updatePosition" data-update-url="<%= account_dashboard_collection_collection_item_path(@account, @collection, collection_item) %>">
                <div class="">
                  <label class="button button--icon button--drag-handle" data-draggable-target="handle">
                    <span class="material-icons">drag_handle</span>
                  </label>
                </div>
                <% if collection_item.post %>
                  <div class="flex-grow-1">
                    <div class="subtitle-1 overflow-ellipsis">
                      <%= collection_item.post.title %>
                    </div>
                    <div class="text-secondary">
                      <%= collection_item.post.account.name %>
                    </div>
                  </div>
                  <div class="list__item__action">
                    <div class="dropdown" data-controller="dropdown">
                      <button type="button" class="button button--icon" data-action="dropdown#toggle">
                        <span class="material-icons">more_vert</span>
                      </button>
                      <div class="dropdown__container dropdown__container--top-right">
                        <a href="<%= account_post_path(collection_item.post.account, collection_item.post) %>" class="dropdown__item">
                          <div class="dropdown__item__icon">
                            <span class="material-icons">preview</span>
                          </div>
                          <div class="dropdown__item__text">
                            <%= t 'common.view' %>
                          </div>
                        </a>
                        <button type="button" class="dropdown__item" data-action="sortable#moveToTop">
                          <div class="dropdown__item__icon">
                            <span class="material-icons">vertical_align_top</span>
                          </div>
                          <div class="dropdown__item__text">
                            <%= t 'common.move_to_top' %>
                          </div>
                        </button>
                        <button type="button" class="dropdown__item" data-action="sortable#moveToBottom">
                          <div class="dropdown__item__icon">
                            <span class="material-icons">vertical_align_bottom</span>
                          </div>
                          <div class="dropdown__item__text">
                            <%= t 'common.move_to_bottom' %>
                          </div>
                        </button>
                        <hr class="divider">
                        <%= button_to account_dashboard_collection_collection_item_path(@account, @collection, collection_item), method: 'delete', class: 'dropdown__item', data: { confirm: t('common.delete_collection_item_confirm') } do %>
                          <div class="dropdown__item__icon">
                            <span class="material-icons">delete</span>
                          </div>
                          <div class="dropdown__item__text">
                            <%= t 'common.delete_collection_item' %>
                          </div>
                        <% end %>
                      </div>
                    </div>
                  </div>
                <% else %>
                  <div class="list__item__content">
                    <div class="text-secondary">
                      <%= t 'common.content_has_expired' %>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>

          <div class="padding">
            <%= paginate @collection_items %>
          </div>
        <% else %>
          <div class="display-flex padding-5 gap-2 text-muted justify-content-center">
              <div class="">
                <span class="material-icons">article</span>
              </div>
              <%= t 'common.no_posts' %>
          </div>
        <% end %>
      </div>

    </div>
  </div>
</div>
