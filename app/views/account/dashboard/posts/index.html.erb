<div class="toolbar">
  <div class="toolbar__title">
    <%= t 'common.posts' %>
  </div>
  <div class="toolbar__action dropdown" data-controller="dropdown">
    <button type="button" class="button button--text" data-action="dropdown#toggle">
      <div class="button__label">
        <% if Post.statuses.include?(params[:status]) %>
          <%= Post.human_attribute_name("status.#{params[:status]}") %>
        <% else %>
          <%= t 'common.status' %>
        <% end %>
      </div>
      <div class="button__icon">
        <span class="material-icons">expand_more</span>
      </div>
    </button>
    <div class="dropdown__menu dropdown__menu--top-right">
      <a href="<%= url_for(post_filter_params.merge(status: nil)) %>" class="dropdown__item">All</a>
      <% Post.statuses.keys.each do |status| %>
        <a href="<%= url_for(post_filter_params.merge(status: status)) %>" class="dropdown__item"><%= Post.human_attribute_name(status) %></a>
      <% end %>
    </div>
  </div>
  <div class="toolbar__action dropdown" data-controller="dropdown">
    <button type="button" class="button button--text" data-action="dropdown#toggle">
      <div class="button__label">
        <% if params[:tag] %>
          <%= params[:tag] %>
        <% else %>
          <%= t 'common.tags' %>
        <% end %>
      </div>
      <div class="button__icon">
        <span class="material-icons">expand_more</span>
      </div>
    </button>
    <div class="dropdown__menu dropdown__menu--top-right">
      <a href="<%= url_for(post_filter_params.merge(tag: nil)) %>" class="dropdown__item">All</a>
      <% @account.post_tags.each do |tag| %>
        <a href="<%= url_for(post_filter_params.merge(tag: tag.name)) %>" class="dropdown__item"><%= tag.name %></a>
      <% end %>
    </div>
  </div>
  <div class="toolbar__action">
    <a href="<%= new_account_dashboard_post_path(@account) %>" class="button button--contained button--primary button--last">
      <div class="button__icon">
        <span class="material-icons">post_add</span>
      </div>
      <div class="button__text">
        <%= t 'common.new_post' %>
      </div>
    </a>
  </div>
</div>

<div class="app-content">
  <div class="padding">
    <div class="card card--outlined">
      <table class="table table--flex">
        <thead>
          <tr>
            <th class="table__cell--title"><%= t 'common.title' %></th>
            <th class="table__cell--attribute"><%= t 'common.status' %></th>
          </tr>
        </thead>
        <tbody>
          <% @posts.each do |post| %>
            <tr>
              <td class="table__cell--title">
                <a href="<%= edit_account_dashboard_post_path(@account, post) %>" class="table__row-link">
                </a>
                <div class="text-primary text-bold">
                  <%= post.title.presence || t('common.untitled') %>
                </div>
                <div class="text-secondary">
                  <%= t 'common.by' %> <%= post.author_users.pluck(:name).join(', ') %>
                  &centerdot;
                  <% if post.tags.any? %>
                    <%= post.tags.pluck(:name).join(', ') %>
                    &centerdot;
                  <% end %>
                  <%= format_time post.updated_at %>
                </div>
              </td>
              <td class="table__cell--attribute">
                <%= Post.human_attribute_name "status.#{post.status}" %>
                <% if post.restricted? %>
                  <span class="text-color-red"><%= t 'common.restricted' %></span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <%= paginate @posts %>
  </div>
</div>
