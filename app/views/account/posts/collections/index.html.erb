<div class="container container--small">
  <%= turbo_frame_tag "post-#{@post.id}-collections" do %>
    <div class="padding-2 border-bottom">
      <div class="top-app-bar align-items-center">
        <div class="top-app-bar__title">
          <div class="title-medium">
            <%= t 'common.add_to_collection' %>
          </div>
        </div>
        <% if current_user.manage_accounts.any? %>
          <div class="top-app-bar__action">
            <div class="dropdown dropdown--right">
              <label tabindex="0" class="button button--text">
                <div class="button__text">
                  <%= @collection_account.display_name %>
                </div>
                <div class="button__icon">
                  <span class="material-icons">expand_more</span>
                </div>
              </label>
              <div tabindex="0" class="dropdown__container">
                <%= button_to switch_account_post_collections_path(@account, @post, account: nil), method: 'put', class: 'dropdown__item' do %>
                  <%= current_user.account.display_name %>
                <% end %>
                <% current_user.manage_accounts.each do |account| %>
                  <%= button_to switch_account_post_collections_path(@account, @post, account: account.name), method: 'put', class: 'dropdown__item' do %>
                    <%= account.display_name %>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
        <div class="top-app-bar__action">
          <label for="post-<%= @post.id %>-collections-dialog-toggle" class="button button--icon">
            <span class="material-icons">close</span>
          </label>
        </div>
      </div>
    </div>

    <div class="overflow-auto padding-x-2">
      <% if @collections.any? %>
        <div class="">
          <% @collections.each do |collection| %>
            <label class="display-flex gap-2 align-items-center padding-y-2 padding-left-2 padding-right-3">
              <div class="line-height-0">
                <%= form_with model: collection, url: account_post_collection_path(@account, @post, collection), builder: CustomFormBuilder, class: 'form', data: { controller: 'form', action: 'change->form#submit' } do |form| %>
                  <%= form.check_box :added %>
                <% end %>
              </div>
              <div class="flex-grow-1">
                <%= collection.name %>
              </div>
              <div class="">
                <% case collection.visibility when 'private' %>
                  <span class="material-icons">lock</span>
                <% when 'public' %>
                  <span class="material-icons">public</span>
                <% end %>
              </div>
            </label>
          <% end %>
        </div>
      <% else %>
        <div class="display-flex align-items-center justify-content-center gap-2 padding-4">
          <span class="material-icons">library_books</span>
          <%= t 'common.no_collections_info' %>
        </div>
      <% end %>
    </div>

    <div class="padding-2 border-top">
      <div class="display-flex justify-content-flex-end padding-1">
        <a href="<%= new_account_post_collection_path(@account, @post) %>" class="button button--text button--primary">
          <div class="button__icon">
            <span class="material-icons">add</span>
          </div>
          <div class="button__text">
            <%= t 'common.new_collection' %>
          </div>
        </a>
      </div>
    </div>
  <% end %>
</div>
