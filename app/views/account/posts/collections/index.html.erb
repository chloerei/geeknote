<div class="container container--small">
  <%= turbo_frame_tag "post-#{@post.id}-collections" do %>
    <div class="display-flex align-items-center gap-2 padding-3 border-bottom">
      <div class="title-medium flex-grow-1">
        <%= t 'common.add_to_collection' %>
      </div>
      <% if current_user.manage_accounts.any? %>
        <div class="dropdown" data-controller="dropdown">
          <button type="button" class="button button--text" data-action="dropdown#toggle">
            <div class="button__text">
              <%= @collection_account.display_name %>
            </div>
            <div class="button__icon">
              <span class="material-icons">expand_more</span>
            </div>
          </button>
          <div class="dropdown__container dropdown__container--top-right">
            <%= button_to switch_account_post_collections_path(@account, @post, account: nil), method: 'put', class: 'dropdown__item' do %>
              <%= current_user.account.display_name %>
            <% end %>
            <% current_user.manage_accounts.each do |account| %>
              <%= button_to switch_account_post_collections_path(@account, @post, account: account.name), method: 'put', class: 'dropdown__item' do %>
                <%= account.display_name %>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
      <button type="button" class="button button--icon" data-action="dialog#close">
        <span class="material-icons">close</span>
      </button>
    </div>

    <div class="overflow-auto">
      <% if @collections.any? %>
        <div class="">
          <% @collections.each do |collection| %>
            <label class="display-flex gap-2 align-items-center padding-y-2 padding-x-3">
              <div class="line-height-0">
                <%= form_with model: collection, url: account_post_collection_path(@account, @post, collection), builder: CustomFormBuilder, class: 'form', data: { controller: 'form', action: 'change->form#submit' } do |form| %>
                  <%= form.check_box :added %>
                <% end %>
              </div>
              <div class="flex-grow-1">
                <%= collection.name %>
              </div>
              <div class="">
                <% case collection.visibility when 'private' %>
                  <span class="material-icons">lock</span>
                <% when 'public' %>
                  <span class="material-icons">public</span>
                <% end %>
              </div>
            </label>
          <% end %>
        </div>
      <% else %>
        <div class="display-flex align-items-center justify-content-center gap-2 padding-4">
          <span class="material-icons">library_books</span>
          <%= t 'common.no_collections_info' %>
        </div>
      <% end %>
    </div>

    <div class="padding-3 border-top">
      <a href="<%= new_account_post_collection_path(@account, @post) %>" class="button button--text button--primary">
        <div class="button__icon">
          <span class="material-icons">add</span>
        </div>
        <div class="button__text">
          <%= t 'common.new_collection' %>
        </div>
      </a>
    </div>
  <% end %>
</div>
