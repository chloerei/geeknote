<% content_for :body do %>
  <div class="app">
    <div class="app-bar-wrapper">
      <div class="app-bar">
        <div class="toolbar">
          <div class="toolbar__action">
            <button type="button" class="button button--icon disabled-on-desktop" data-controller="toggle" data-toggle-target="#drawer" data-toggle-action="drawer#toggle">
              <span class="material-icons">menu</span>
            </button>
          </div>
          <div class="toolbar__title">
            <a href="<%= account_dashboard_root_path(@account) %>">
              GeekNote <%= t 'common.dashboard' %>
            </a>
          </div>
          <div class="toolbar__action">
            <a href="<%= new_account_dashboard_post_path(@account) %>" class="button button--icon">
              <span class="material-icons">post_add</span>
            </a>
          </div>
          <div class="toolbar__action">
            <a href="<%= notifications_path %>" class="button button--icon <%= 'notification-unread' if current_user.notifications.unread.count > 0 %>">
              <span class="material-icons">notifications</span>
            </a>
          </div>
          <div class="toolbar__action dropdown" data-controller="dropdown">
            <button type="button" class="button button--icon button--avatar" data-action="dropdown#toggle">
              <div class="avatar">
                <%= avatar_image_tag current_user.avatar %>
              </div>
            </button>
            <div class="dropdown__menu dropdown__menu--top-right">
              <a href="<%= account_root_path(current_user.account) %>" class="dropdown__item">
                <div class="dropdown__item__icon">
                  <span class="material-icons">account_box</span>
                </div>
                <div class="dropdown__item__text">
                  <%= t 'common.profile' %>
                </div>
              </a>
              <a href="<%= root_path %>" class="dropdown__item">
                <div class="dropdown__item__icon">
                  <span class="material-icons">home</span>
                </div>
                <div class="dropdown__item__text">
                  <%= t 'common.home' %>
                </div>
              </a>
              <a href="<%= organizations_path %>" class="dropdown__item">
                <div class="dropdown__item__icon">
                  <span class="material-icons">switch_account</span>
                </div>
                <div class="dropdown__item__text">
                  <%= t 'common.organizations' %>
                </div>
              </a>
              <a href="<%= settings_account_path %>" class="dropdown__item">
                <div class="dropdown__item__icon">
                  <span class="material-icons">settings</span>
                </div>
                <div class="dropdown__item__text">
                  <%= t 'common.settings' %>
                </div>
              </a>
              <hr class="divider">
              <%= form_with url: sign_out_path, method: 'delete' do %>
                <button type="submit" class="dropdown__item">
                  <div class="dropdown__item__icon">
                    <span class="material-icons">logout</span>
                  </div>
                  <div class="dropdown__item__text">
                    <%= t 'common.sign_out' %>
                  </div>
                </button>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <div class="app-bar-wrapper__content">
        <div class="drawer-wrapper">
          <div id="drawer" class="drawer" data-controller="drawer">
            <div class="drawer__container">
              <div class="padding text-align-center">
                <div class="avatar avatar--medium margin-bottom-8">
                  <%= avatar_image_tag @account.owner.avatar %>
                </div>
                <div class="text-primary text-bold">
                  <%= @account.owner.name %>
                </div>
                <div class="text-secondary">
                  <%= @account.user? ? t('common.personal_account') : t('common.organization_account') %>
                </div>
              </div>
              <div class="nav">
                <a href="<%= account_dashboard_root_path(@account) %>" class="nav__item <%= 'nav__item--active' if controller_name == 'home' %>">
                  <div class="nav__item__icon">
                    <span class="material-icons">dashboard</span>
                  </div>
                  <div class="nav__item__text">
                    <%= t 'common.home' %>
                  </div>
                </a>
                <a href="<%= account_dashboard_posts_path(@account) %>" class="nav__item <%= 'nav__item--active' if controller_name == 'posts' %>">
                  <div class="nav__item__icon">
                    <span class="material-icons">article</span>
                  </div>
                  <div class="nav__item__text">
                    <%= t 'common.posts' %>
                  </div>
                </a>
                <% if @account.organization? && current_member.has_permission?(:manage_member) %>
                  <a href="<%= account_dashboard_members_path %>" class="nav__item <%= 'nav__item--active' if controller_name == 'members' %>">
                    <div class="nav__item__icon">
                      <span class="material-icons">people</span>
                    </div>
                    <div class="nav__item__text">
                      <%= t 'common.members' %>
                    </div>
                  </a>
                <% end %>
                <% if current_member.has_permission?(:edit_account_settings) %>
                  <a href="<%= account_dashboard_settings_path %>" class="nav__item <%= 'nav__item--active' if request.path.include?('settings') %>">
                    <div class="nav__item__icon">
                      <span class="material-icons">settings</span>
                    </div>
                    <div class="nav__item__text">
                      <%= t 'common.settings' %>
                    </div>
                  </a>
                <% end %>
                <a href="<%= account_root_path(@account) %>" class="nav__item">
                  <div class="nav__item__icon">
                    <span class="material-icons">web</span>
                  </div>
                  <div class="nav__item__text">
                    <%= t 'common.view_site' %>
                  </div>
                </a>
              </div>
            </div>
            <div class="drawer__scrim" data-action="click->drawer#close">
            </div>
          </div>

          <div class="drawer-wrapper__content">
            <div class="app-content">
              <%= yield %>

              <div id="snackbar-container" class="snackbar-container">
                <% if flash[:notice] %>
                  <div class="snackbar" data-controller="snackbar" data-snackbar-period="5000">
                    <%= flash[:notice] %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<%= render template: 'layouts/base' %>
